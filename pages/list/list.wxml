<wxs module="filters" src="../../utils/tofix.wxs"></wxs>

<view class="wrapper">
  <view class="nav">    
    <scroll-view      
      scroll-with-animation="{{true}}" 
      scroll-into-view="a{{index}}"  
      enable-flex="true" 
      scroll-x="true" 
      scroll-y="false" 
    class="sub-nav">
      <view
        id="a{{index}}"
        wx:for="{{buildings}}"
        wx:key="index"
        class="nav-item {{buildings[choosedBuilding] == item ? 'choosed' : ''}}"
        data-building="{{item}}"
        bindtap="tapBuilding"
      >
        {{item}}
      </view>
    </scroll-view>
  </view> 
  <view class="build-info"> 直线距离{{distance[index]}}米，走路预计    
    {{filters.toFix(distance[index]/50)}}分钟</view>
   <view class="table">
    <view class="tr comment">
      <view class="comment-cell">
        <view class="status free"></view><view class="comment-item c1">空闲</view>
        <view class="status inuse"></view><view class="comment-item c2">有课</view> 
        <view class="status busy"></view><view class="comment-item c3">被占</view> 
      </view>
      <view class="comment-cell">
        <view class="comment-item c4">| 上午</view> 
        <view class="comment-item c5"> t1</view> 
        <view class="comment-item c6">| 下午</view> 
        <view class="comment-item c7"> t2</view> 
        <view class="comment-item c8">| 晚上</view> 
      </view>
      </view>
  </view>

  <swiper 
    circular
    duration="300"
    current="{{choosedBuilding}}"
    bindanimationfinish="changeTabs"
    nav-class="tabs" 
    
  >
    <swiper-item
        wx:for="{{buildings}}"
        wx:key="index"
        data-campus="{{item}}"      
      >
      <scroll-view
      refresher-triggered = '{{loading}}' 
      bindrefresherrefresh="onRefresh"

        refresher-enabled="true"
        class="item-scroll-view"        
        scroll-y="true" 
        name="{{item}}">
    <view       
      wx:if="{{data}}"           
      >
      <view
        bindlongpress="handleShowFeedBack" 
        wx:for="{{data[index]['classList']}}"
        wx:for-index="roomName"
        wx:for-item="statusList"
        wx:key="roomName"
        id="{{statusList['rname']}}"
        class="tr"                
      > 
        <view class="td room-name-tuple" bindtap="tapCourse">
          <view class="room-name">{{statusList['rname']}}</view>
          <view class="room-metadata">
            <view>座位数 {{ statusList['rspace']}}</view>
            <view wx:if="{{statusList['typeDesc']}}">/ {{statusList['typeDesc']}}</view>
          </view>
        </view>
        <view class="td status-list">
          <view
            wx:for="{{[1,2,3,4,5]}}"
            wx:for-item="n"
            wx:key="n"            
            class=
            "status {{statusList['status'][n-1] == 1 ? 'inuse' : ''}}{{statusList['status'][n-1] == 0? 'free':''}}{{statusList['status'][n-1] == -1? 'busy':''}} {{nowInterval == n ? 'now' : ''}}"
          ></view>
          <view class="delimiter"></view>
          <view
            wx:for="{{[6,7,8,9,10]}}"
            wx:for-item="n"
            wx:key="n"
            class="status {{statusList['status'][n-1] == 1 ? 'inuse' : ''}}{{statusList['status'][n-1] == 0? 'free':''}}{{statusList['status'][n-1] == -1? 'busy':''}} {{nowInterval == n  ? 'now' : ''}}"
          ></view>
          <view class="delimiter"></view>
          <view            
            wx:for="{{[11,12,13]}}"
            wx:for-item="n"
            wx:key="n"
            class="status {{statusList['status'][n-1] == 1 ? 'inuse' : ''}}{{statusList['status'][n-1] == 0? 'free':''}}{{statusList['status'][n-1] == -1? 'busy':''}} {{nowInterval == n  ? 'now' : ''}}"
          ></view>
        </view>
      </view>
    </view>
    <view wx:else>
      <view 
        wx:for="{{[0]}}"
        wx:key="index"
        class="tr"
      >
        <view class="td room-name" >{{ index == 0 ? "数据加载中..." : "" }}</view>
        <view class="td status-list" bindtap="tapCourse">
          <view          
            wx:for="{{[1, 2, 3, 4, 5]}}"
            wx:key="item"
            class="status loading"
          ></view>
          <view class="delimiter"></view>
          <view
            wx:for="{{[6, 7, 8, 9, 10]}}"
            wx:key="item"
            class="status loading"
          ></view>
          <view class="delimiter"></view>
          <view
            wx:for="{{[11, 12, 13, 14]}}"
            wx:key="item"
            class="status loading"
          ></view>
        </view>
      </view>
    </view>  
  </scroll-view>        
</swiper-item>
 
  </swiper>
<!-- 长按反馈 -->
<van-popup
  round
  close-on-click-overlay
  show="{{ showFeedBack }}"
  position="bottom"
  closeable
  custom-style="height: 40%;z-index:999"
  overlay-style="z-index:999"
  bind:close="onFeedBackClose"
>
  <van-panel title="{{feedbackClassName}}" desc="信息有误?" use-footer-slot footer-class="feedBackFooter">
    <van-checkbox-group value="{{ feedBackCheckbox }}" bind:change="feedBackCheckboxChange" >   
        <van-checkbox class="checkbox time-checkbox" wx:key="index" wx:for="{{['教室类型错误','教室状态错误','压根没这个教室','其他'] }}" wx:for-item="i" shape="square" checked-color="#fed457" name="{{index}}">
          <text class="checkboxText">{{i}}</text>          
        </van-checkbox>
      </van-checkbox-group>
    <van-field
    value="{{ value }}"
    placeholder="请输入反馈意见(可为空)"
    border="{{ false }}"
    bind:change="onChange"
  />
    <view slot="footer" >
      <van-button size="small" bindtap="onFeedBackClose">取消</van-button>
      <van-button size="small" bindtap="onFeedBackDone" color="#fde06b" custom-style="color:#000;margin-left:30rpx">反馈</van-button>
    </view>
  </van-panel>
</van-popup>
</view>
